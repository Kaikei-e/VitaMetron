# ライトモード視認性の修正 — Tailwind dark: バリアントの統一適用

## ADR's STATUS

採用済み (2026-02-19)

## CONTEXT

UI はダークモードを前提に構築された経緯があり、多くのコンポーネントで背景色・テキスト色がダークテーマ向けにハードコードされていた。OS/ブラウザの `prefers-color-scheme: light` 時に以下の問題が発生していた:

- **テキストが背景と同化して読めない**: `text-gray-200`（薄いグレー）が白背景上で不可視
- **バッジ・バナーがダーク固定**: `bg-green-800 text-green-200` などダーク専用の配色
- **CSS 変数がダーク前提**: `<style>` ブロック内の `color: var(--color-gray-300)` がライトモードで不可視
- **スケルトン UI がダーク固定**: ローディング表示の `bg-gray-800/50` がライトモードで暗すぎる

一方、`Card.svelte`・ナビゲーション系・フォーム系コンポーネントは既に `bg-white dark:bg-gray-900` のパターンで正しく両対応していた。

## DECISION MAKING

### 検討した選択肢

| 選択肢 | 概要 | 評価 |
|---|---|---|
| A. CSS カスタムプロパティによるテーマシステム導入 | `:root` と `[data-theme="dark"]` でカスタムプロパティを定義し全コンポーネントで参照 | △ 大規模リファクタリングが必要、既存の `dark:` パターンとの混在 |
| B. テーマトグル付きのクラスベース dark mode | Tailwind の `selector` 戦略に切り替え、手動トグルを追加 | △ 既存の `prefers-color-scheme` ベースの `dark:` が全て壊れる |
| C. 既存パターンに合わせて `dark:` バリアントを統一適用 | 不足している箇所に `dark:` を追加、ライトモードのデフォルト色を設定 | ✅ 採用 |

### 選択肢 C を採用した理由

- **既存の良いパターンが多数存在**: `Card.svelte` の `bg-white dark:bg-gray-900` や、ナビゲーション系の `dark:` 対応が参考実装として使える
- **変更の局所性**: 問題のあるコンポーネント7ファイルのみの修正で完結
- **Tailwind CSS 4 のデフォルト動作を維持**: `prefers-color-scheme` メディアクエリによる自動切り替えをそのまま利用
- **テーマトグル不要**: OS/ブラウザ設定に追従する既存動作で十分

### 適用ルール

全コンポーネントで以下のパターンを統一:

```
ライトモードのデフォルト色  dark:ダークモードの色
```

例: `bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-200`

`<style>` ブロック内の CSS 変数は `@media (prefers-color-scheme: dark)` で分岐。

## RESULTS, EFFECTS

### PROS

- **ライト/ダーク両モードで視認性が確保される**: すべてのテキスト・バッジ・バナーが両テーマで読みやすくなった
- **既存のダークモード表示を壊さない**: `dark:` プレフィックスで上書きするため、ダークモード時は従来と同じ配色
- **コードベースの一貫性向上**: 全コンポーネントが同じ `ライト dark:ダーク` パターンに統一された
- **型チェック・ビルドエラーなし**: `svelte-check` で 0 errors / 0 warnings を確認済み

### CONS, TRADEOFF

- **クラス文字列の肥大化**: `dark:` バリアント追加により一部の class 属性が長くなる（可読性の軽微な低下）
- **CSS 変数の `@media` 分岐が冗長**: `DailyAdviceCard` の `<style>` ブロックは `@media (prefers-color-scheme: dark)` で重複記述が必要
- **手動検証が必要**: Tailwind の `dark:` は静的解析でライト/ダーク両方の視認性を検証できないため、目視確認に依存する

## APPENDIX

### 変更ファイル一覧

| ファイル | 優先度 | 変更内容 |
|---|---|---|
| `frontend/src/lib/components/ui/SkeletonCard.svelte` | CRITICAL | `bg-gray-200 dark:bg-gray-800/50`、`bg-gray-300 dark:bg-gray-700` に変更 |
| `frontend/src/lib/components/dashboard/DailyAdviceCard.svelte` | CRITICAL | テキスト色・cached バッジ・`<style>` 内 CSS 変数をライト/ダーク両対応 |
| `frontend/src/routes/+page.svelte` | CRITICAL | データ品質警告バナー・ベースラインバナー・Confidence バッジをライト/ダーク両対応 |
| `frontend/src/lib/components/dashboard/VRICard.svelte` | CRITICAL | Confidence バッジ・プログレスバー背景をライト/ダーク両対応 |
| `frontend/src/lib/components/insights/HRVPredictionCard.svelte` | MODERATE | Confidence バッジをライト/ダーク両対応 |
| `frontend/src/lib/components/ui/Badge.svelte` | MODERATE | 全4バリアント (default/success/warning/error) に `dark:` 追加 |
| `frontend/src/lib/components/dashboard/SyncStatus.svelte` | MINOR | ヘッダー・toast・テキスト色に `dark:` 追加 |

### 変更不要と判断したコンポーネント

以下は既にライト/ダーク両対応済みのため修正対象外:

- `Card.svelte` — `bg-white dark:bg-gray-900`
- ナビゲーション系 (`Sidebar`, `BottomNav`, `NavItem`) — 全て `dark:` 対応済み
- フォーム系 (`ConditionForm`, `VASSlider`) — 対応済み
- Chart.js 系 (`IntradayHRChart`, `SleepStageTimeline`) — `isDark()` で動的に色切り替え
- Divergence 関連 — `dark:` 対応済み
- `HelpTooltip` — ツールチップは常時ダーク背景（一般的な UI パターン）
